<!doctype html>

<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Contador de Pixels (ignora transparência)</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --fg:#e5e7eb; --accent:#38bdf8; }
    html,body{height:100%}
    body{margin:0; background:linear-gradient(135deg,#0b1021,#121a2b); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;}
    .wrap{max-width:980px; margin:24px auto; padding:16px}
    .card{background:rgba(17,24,39,.75); border:1px solid rgba(148,163,184,.15); border-radius:18px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,.35); backdrop-filter: blur(8px)}
    h1{margin:0 0 8px; font-size: clamp(20px, 3vw, 30px)}
    p{color:var(--muted); margin:6px 0 18px}
    .u{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .btn{background:var(--accent); color:#00131a; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .drop{border:2px dashed rgba(56,189,248,.6); border-radius:14px; padding:18px; text-align:center; color:var(--muted)}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px; margin-top:16px}
    .stat{background:#0b1220; border:1px solid rgba(148,163,184,.15); border-radius:12px; padding:12px}
    .stat h3{margin:0; font-size:14px; color:var(--muted)}
    .stat .v{font-size:20px; margin-top:6px; font-weight:800}
    .thumb{max-width:100%; border-radius:10px; display:block; margin-top:10px}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    input[type="range"]{width:220px}
    code.small{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size:12px; color:#cbd5e1}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Contador de Pixels (ignora transparência)</h1>
      <p>Carregue uma imagem (PNG, JPG, WebP, etc.). O contador soma <b>apenas os pixels com alfa ≥ limite</b> (padrão: ≥ 1). Ideal para pixel art com fundo transparente.</p><div class="u">
    <input id="file" type="file" accept="image/*" />
    <button id="demo" class="btn" type="button">Usar imagem de exemplo</button>
    <div class="row">
      <label for="th">Limite de Alfa:</label>
      <input id="th" type="range" min="0" max="255" value="1" />
      <span id="thv">1</span>
    </div>
  </div>

  <div id="drop" class="drop" style="margin-top:12px">Solte a imagem aqui ou use o seletor acima. Você também pode <b>colar</b> (Ctrl/Cmd+V) uma imagem do clipboard.</div>

  <div class="grid">
    <div class="stat">
      <h3>Dimensões</h3>
      <div class="v" id="dims">—</div>
    </div>
    <div class="stat">
      <h3>Pixels totais (largura × altura)</h3>
      <div class="v" id="total">—</div>
    </div>
    <div class="stat">
      <h3>Pixels visíveis (alfa ≥ limite)</h3>
      <div class="v" id="visible">—</div>
    </div>
    <div class="stat">
      <h3>Transparência (0 ≤ alfa &lt; limite)</h3>
      <div class="v" id="transparent">—</div>
    </div>
    <div class="stat">
      <h3>Percentual visível</h3>
      <div class="v" id="percent">—</div>
    </div>
  </div>

  <img id="preview" class="thumb" alt="Prévia" />

  <canvas id="cv" style="display:none"></canvas>
  <p style="margin-top:12px"><code class="small">Dica: se sua imagem tiver semitransparência, aumente o limite para considerar apenas pixels mais opacos (por exemplo, 128).</code></p>
</div>

  </div><script>
const fileInput = document.getElementById('file');
const drop = document.getElementById('drop');
const th = document.getElementById('th');
const thv = document.getElementById('thv');
const preview = document.getElementById('preview');
const cv = document.getElementById('cv');
const dims = document.getElementById('dims');
const total = document.getElementById('total');
const visible = document.getElementById('visible');
const transparent = document.getElementById('transparent');
const percent = document.getElementById('percent');
const demo = document.getElementById('demo');

function formatNumber(n){
  return n.toLocaleString('pt-BR');
}

function resetStats(){
  dims.textContent = '—';
  total.textContent = '—';
  visible.textContent = '—';
  transparent.textContent = '—';
  percent.textContent = '—';
}

async function loadImageFromBlob(blob){
  return new Promise((resolve, reject)=>{
    const url = URL.createObjectURL(blob);
    const img = new Image();
    img.onload = ()=>{ resolve({img, url}); };
    img.onerror = reject;
    img.src = url;
  });
}

async function handleFile(file){
  if(!file) return;
  resetStats();
  const {img, url} = await loadImageFromBlob(file);
  preview.src = url;

  const ctx = cv.getContext('2d', { willReadFrequently: true });
  cv.width = img.naturalWidth;
  cv.height = img.naturalHeight;
  ctx.clearRect(0,0,cv.width,cv.height);
  ctx.drawImage(img,0,0);
  updateCounts();
}

function updateCounts(){
  const aLimit = parseInt(th.value,10);
  thv.textContent = aLimit;
  const w = cv.width, h = cv.height;
  if(!w || !h){ resetStats(); return; }
  const ctx = cv.getContext('2d', { willReadFrequently: true });
  const { data } = ctx.getImageData(0,0,w,h);
  const totalPx = w * h;
  let vis = 0;
  // data = [r,g,b,a, r,g,b,a, ...]
  for(let i=3;i<data.length;i+=4){
    if(data[i] >= aLimit) vis++;
  }
  const transp = totalPx - vis;
  dims.textContent = `${w} × ${h} px`;
  total.textContent = formatNumber(totalPx);
  visible.textContent = formatNumber(vis);
  transparent.textContent = formatNumber(transp);
  percent.textContent = totalPx ? ((vis/totalPx)*100).toFixed(2)+"%" : '—';
}

// Eventos
fileInput.addEventListener('change', (e)=> handleFile(e.target.files[0]));
th.addEventListener('input', updateCounts);

['dragenter','dragover'].forEach(ev=> drop.addEventListener(ev, e=>{e.preventDefault(); drop.style.borderColor = '#7dd3fc';}));
['dragleave','drop'].forEach(ev=> drop.addEventListener(ev, e=>{e.preventDefault(); drop.style.borderColor = 'rgba(56,189,248,.6)';}));
drop.addEventListener('drop', e=>{
  const f = e.dataTransfer.files && e.dataTransfer.files[0];
  if(f) handleFile(f);
});

window.addEventListener('paste', async (e)=>{
  const items = e.clipboardData?.items;
  if(!items) return;
  for(const it of items){
    if(it.kind === 'file' && it.type.startsWith('image/')){
      const f = it.getAsFile();
      await handleFile(f);
      break;
    }
  }
});

// Imagem de exemplo (um PNG com área transparente)
demo.addEventListener('click', async ()=>{
  // Gera uma pequena imagem de exemplo via canvas
  const c = document.createElement('canvas');
  c.width = 16; c.height = 16;
  const cx = c.getContext('2d');
  // Fundo transparente por padrão
  // Desenha um quadrado opaco 8x8 e um quadrado semi-transparente
  cx.fillStyle = '#22c55e';
  cx.fillRect(0,0,8,8);
  cx.fillStyle = 'rgba(99,102,241,0.5)';
  cx.fillRect(8,8,8,8);
  c.toBlob(async (blob)=>{
    await handleFile(new File([blob], 'exemplo.png', {type:'image/png'}));
  });
});
</script></body>
</html>
